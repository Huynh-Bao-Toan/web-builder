(function(){"use strict";const state ={currentSlide: 0,slides: [],activeProductTab: null,activeVoucherTab: null,};function initSlider(){const slides = document.querySelectorAll(".slider-item");const dots = document.querySelectorAll(".dot");const prevBtn = document.getElementById("slider-prev");const nextBtn = document.getElementById("slider-next");state.slides = Array.from(slides);prevBtn.addEventListener("click",()=>{goToSlide(state.currentSlide - 1);});nextBtn.addEventListener("click",()=>{goToSlide(state.currentSlide + 1);});dots.forEach((dot,index)=>{dot.addEventListener("click",()=>{goToSlide(index);});});setInterval(()=>{goToSlide(state.currentSlide + 1);},5000);}function goToSlide(index){const slides = state.slides;const dots = document.querySelectorAll(".dot");if(index < 0){index = slides.length - 1;}else if(index >= slides.length){index = 0;}state.currentSlide = index;slides.forEach((slide,i)=>{slide.classList.toggle("active",i === index);});dots.forEach((dot,i)=>{dot.classList.toggle("active",i === index);});}function initProductTabs(){const productTabs = document.querySelectorAll("#product-tabs-nav .tab-item");const firstTab = productTabs[0];if(firstTab){const type = firstTab.getAttribute("data-type");const endpoint = firstTab.getAttribute("data-api-endpoint");const tabId = firstTab.getAttribute("data-tab-id");state.activeProductTab = tabId;dispatchTabActivatedEvent(type,endpoint,tabId);}productTabs.forEach((tab)=>{tab.addEventListener("click",function(){productTabs.forEach((t)=> t.classList.remove("active"));this.classList.add("active");const type = this.getAttribute("data-type");const endpoint = this.getAttribute("data-api-endpoint");const tabId = this.getAttribute("data-tab-id");state.activeProductTab = tabId;dispatchTabActivatedEvent(type,endpoint,tabId);});});}function initVoucherTabs(){const voucherTabs = document.querySelectorAll("#voucher-tabs-nav .tab-item");const firstTab = voucherTabs[0];if(firstTab){const type = firstTab.getAttribute("data-type");const endpoint = firstTab.getAttribute("data-api-endpoint");const tabId = firstTab.getAttribute("data-tab-id");state.activeVoucherTab = tabId;dispatchTabActivatedEvent(type,endpoint,tabId);}voucherTabs.forEach((tab)=>{tab.addEventListener("click",function(){voucherTabs.forEach((t)=> t.classList.remove("active"));this.classList.add("active");const type = this.getAttribute("data-type");const endpoint = this.getAttribute("data-api-endpoint");const tabId = this.getAttribute("data-tab-id");state.activeVoucherTab = tabId;dispatchTabActivatedEvent(type,endpoint,tabId);});});}function dispatchTabActivatedEvent(type,apiEndpoint,tabId){const event = new CustomEvent("tabActivated",{detail:{type: type,apiEndpoint: apiEndpoint,tabId: tabId,timestamp: new Date().toISOString(),},bubbles: true,cancelable: true,});document.dispatchEvent(event);console.log("Tab activated event dispatched:",event.detail);}function renderProducts(data){const productsGrid = document.getElementById("products-grid");if(!data || !data.items || data.items.length === 0){productsGrid.innerHTML = '<div class="products-loading">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o</div>';return;}if(typeof window.renderProducts === 'function'){window.renderProducts(data,productsGrid);dispatchComponentRenderedEvent("product",data);return;}if(typeof window.renderProductItem === 'function'){const productsHTML = data.items .map((product)=> window.renderProductItem(product)).join("");productsGrid.innerHTML = productsHTML;attachAddToCartListeners();dispatchComponentRenderedEvent("product",data);return;}const event = new CustomEvent("renderProductsRequested",{detail:{type: "product",data: data,targetElement: productsGrid,timestamp: new Date().toISOString(),},bubbles: true,cancelable: true,});document.dispatchEvent(event);if(!event.defaultPrevented){renderProductsDefault(data);}}function renderProductsDefault(data){const productsGrid = document.getElementById("products-grid");const productsHTML = data.items .map((product)=>{const discountPercent = product.discount ? Math.round(((product.originalPrice - product.price)/ product.originalPrice)* 100): 0;const stars = "‚òÖ".repeat(Math.floor(product.rating || 5));const productDataJson = JSON.stringify(product).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return ` <div class="product-card" data-component-type="product" data-product-id="${product.id}" data-product-data='${productDataJson}'> <img src="${product.image}" alt="${product.title}" class="product-image" /> <div class="product-info"> <h3 class="product-title">${product.title}</h3> <div class="product-rating"> <span class="product-rating-stars">${stars}</span> <span class="product-rating-text">(${product.reviewCount || 0})</span> </div> <div class="product-sales">ƒê√£ b√°n ${formatSales(product.sales)}</div> <div class="product-price">${formatPrice(product.price)}</div> ${discountPercent > 0 ? `<span class="product-discount">-${discountPercent}%</span>` : ""}<div class="product-actions"> <button class="add-to-cart" data-product-id="${product.id}"> Th√™m v√†o gi·ªè </button> </div> </div> </div> `;}).join("");productsGrid.innerHTML = productsHTML;attachAddToCartListeners();dispatchComponentRenderedEvent("product",data);}function renderVouchers(data){const vouchersGrid = document.getElementById("vouchers-grid");if(!data || !data.items || data.items.length === 0){vouchersGrid.innerHTML = '<div class="vouchers-loading">Kh√¥ng c√≥ voucher n√†o</div>';return;}if(typeof window.renderVouchers === 'function'){window.renderVouchers(data,vouchersGrid);dispatchComponentRenderedEvent("voucher",data);return;}if(typeof window.renderVoucherItem === 'function'){const vouchersHTML = data.items .map((voucher)=> window.renderVoucherItem(voucher)).join("");vouchersGrid.innerHTML = vouchersHTML;attachVoucherCopyListeners();dispatchComponentRenderedEvent("voucher",data);return;}const event = new CustomEvent("renderVouchersRequested",{detail:{type: "voucher",data: data,targetElement: vouchersGrid,timestamp: new Date().toISOString(),},bubbles: true,cancelable: true,});document.dispatchEvent(event);if(!event.defaultPrevented){renderVouchersDefault(data);}}function renderVouchersDefault(data){const vouchersGrid = document.getElementById("vouchers-grid");const vouchersHTML = data.items .map((voucher)=>{return ` <div class="voucher-card" data-component-type="voucher" data-voucher-id="${voucher.id}"> <div class="voucher-header"> <div class="voucher-title">${voucher.title}</div> <div class="voucher-code">${voucher.code}</div> </div> <div class="voucher-description">${voucher.description}</div> <div class="voucher-value">${voucher.value}</div> <div class="voucher-footer"> <div class="voucher-validity"> <span>üìÖ</span> <span>HSD: ${formatDate(voucher.expiryDate)}</span> </div> <button class="voucher-copy-btn" data-voucher-code="${voucher.code}"> Sao ch√©p </button> </div> </div> `;}).join("");vouchersGrid.innerHTML = vouchersHTML;attachVoucherCopyListeners();dispatchComponentRenderedEvent("voucher",data);}window.updateLandingData = function(type,data){if(type === "product"){renderProducts(data);}else if(type === "voucher"){renderVouchers(data);}};function formatPrice(price){return new Intl.NumberFormat("vi-VN",{style: "currency",currency: "VND",}).format(price);}function formatSales(sales){if(sales >= 1000000){return(sales / 1000000).toFixed(1)+ "M+";}else if(sales >= 1000){return(sales / 1000).toFixed(0)+ "K+";}return sales + "+";}function formatDate(dateString){const date = new Date(dateString);return date.toLocaleDateString("vi-VN");}function attachAddToCartListeners(){const addToCartButtons = document.querySelectorAll(".add-to-cart");addToCartButtons.forEach((button)=>{button.replaceWith(button.cloneNode(true));});document.querySelectorAll(".add-to-cart").forEach((button)=>{button.addEventListener("click",function(){const productId = this.getAttribute("data-product-id");const productCard = this.closest(".product-card");const productData = extractProductData(productCard);dispatchAddToCartEvent(productId,productData);});});}function extractProductData(productCard){if(!productCard)return null;const productDataJson = productCard.getAttribute("data-product-data");if(productDataJson){try{const decodedJson = productDataJson .replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");const productData = JSON.parse(decodedJson);return productData;}catch(e){console.warn("Failed to parse product data from attribute:",e);}}const productId = productCard.getAttribute("data-product-id");const title = productCard.querySelector(".product-title")?.textContent || "";const image = productCard.querySelector(".product-image")?.getAttribute("src")|| "";const priceText = productCard.querySelector(".product-price")?.textContent || "";const priceMatch = priceText.replace(/[^\d]/g,"");const price = priceMatch ? parseInt(priceMatch,10): 0;return{id: productId,title: title,image: image,price: price,};}function attachVoucherCopyListeners(){const copyButtons = document.querySelectorAll(".voucher-copy-btn");copyButtons.forEach((button)=>{button.replaceWith(button.cloneNode(true));});document.querySelectorAll(".voucher-copy-btn").forEach((button)=>{button.addEventListener("click",function(){const voucherCode = this.getAttribute("data-voucher-code");dispatchVoucherCopyEvent(voucherCode);});});}function dispatchComponentRenderedEvent(componentType,data){const event = new CustomEvent("componentRendered",{detail:{type: componentType,data: data,timestamp: new Date().toISOString(),},bubbles: true,cancelable: true,});document.dispatchEvent(event);console.log("Component rendered event dispatched:",{type: componentType,itemCount: data?.items?.length || 0,});}function dispatchAddToCartEvent(productId,productData){const event = new CustomEvent("addToCart",{detail:{productId: productId,productData: productData,type: "product",timestamp: new Date().toISOString(),},bubbles: true,cancelable: true,});document.dispatchEvent(event);console.log("Add to cart event dispatched:",{productId: productId,productData: productData,});}function dispatchVoucherCopyEvent(voucherCode){if(navigator.clipboard && navigator.clipboard.writeText){navigator.clipboard .writeText(voucherCode).then(()=>{console.log("Voucher code copied to clipboard:",voucherCode);}).catch((err)=>{console.error("Failed to copy voucher code:",err);});}const event = new CustomEvent("voucherCopy",{detail:{code: voucherCode,type: "voucher",timestamp: new Date().toISOString(),},bubbles: true,cancelable: true,});document.dispatchEvent(event);console.log("Voucher copy event dispatched:",{code: voucherCode});}function init(){if(document.readyState === "loading"){document.addEventListener("DOMContentLoaded",init);}else{initSlider();initProductTabs();initVoucherTabs();console.log("Landing page builder JS initialized");}}init();})();